{% extends 'admin/master.html' %}
{% block body %}

<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-12">
            <div class="admin-header-card">
                <div class="admin-header-content">
                    <div class="admin-header-icon">
                        <i class="fas fa-edit"></i>
                    </div>
                    <div>
                        <h1 class="admin-header-title">Ajuste de Estoque</h1>
                        <p class="admin-header-subtitle">Adicione ou remova itens do inventário</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-lg-8 mx-auto">
            <div class="admin-activity-card">
                <h2 class="admin-section-title">
                    <i class="fas fa-plus-minus text-warning me-2"></i>
                    Formulário de Ajuste
                </h2>
                <div class="p-4">
                    <form method="POST" action="{{ url_for('inventorymanagementview.adjust_stock') }}">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="product_id" class="form-label">Produto *</label>
                                <select class="form-select" id="product_id" name="product_id" required>
                                    <option value="">Selecione um produto...</option>
                                    {% for product in products %}
                                    <option value="{{ product.id }}">
                                        {{ product.name }} (Estoque: {{ product.stock_quantity }})
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="quantity_change" class="form-label">Quantidade *</label>
                                <input type="number" class="form-control" id="quantity_change" name="quantity_change" 
                                       placeholder="Digite + para adicionar, - para remover" required>
                                <div class="form-text">
                                    Use números positivos para adicionar (+10) ou negativos para remover (-5)
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="reason" class="form-label">Motivo do Ajuste</label>
                            <textarea class="form-control" id="reason" name="reason" rows="3" 
                                    placeholder="Descreva o motivo do ajuste (opcional)">Ajuste manual via admin</textarea>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('inventorymanagementview.index') }}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-2"></i>
                                Voltar
                            </a>
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-save me-2"></i>
                                Aplicar Ajuste
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Information -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="admin-activity-card">
                <h2 class="admin-section-title">
                    <i class="fas fa-info-circle text-info me-2"></i>
                    Informações de Estoque
                </h2>
                <div class="p-4">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Produto</th>
                                    <th>SKU</th>
                                    <th>Estoque Atual</th>
                                    <th>Estoque Mínimo</th>
                                    <th>Status</th>
                                    <th>Fornecedor</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for product in products %}
                                <tr>
                                    <td>
                                        <strong>{{ product.name }}</strong>
                                        {% if product.image_url %}
                                        <img src="{{ product.image_url }}" alt="{{ product.name }}" 
                                             style="width: 30px; height: 30px; object-fit: cover; border-radius: 4px;" class="ms-2">
                                        {% endif %}
                                    </td>
                                    <td>{{ product.sku or 'N/A' }}</td>
                                    <td>
                                        <span class="badge bg-{{ 'danger' if product.stock_quantity <= product.min_stock_level else 'warning' if product.stock_quantity <= product.min_stock_level * 2 else 'success' }}">
                                            {{ product.stock_quantity }}
                                        </span>
                                    </td>
                                    <td>{{ product.min_stock_level }}</td>
                                    <td>
                                        {% if product.stock_quantity == 0 %}
                                            <span class="badge bg-danger">Sem Estoque</span>
                                        {% elif product.stock_quantity <= product.min_stock_level %}
                                            <span class="badge bg-warning">Estoque Baixo</span>
                                        {% else %}
                                            <span class="badge bg-success">OK</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ product.supplier or 'N/A' }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.admin-header-card {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    border-radius: 15px;
    padding: 25px;
    color: white;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.admin-header-content {
    display: flex;
    align-items: center;
    gap: 20px;
}

.admin-header-icon {
    font-size: 3rem;
    opacity: 0.8;
}

.admin-header-title {
    margin: 0;
    font-size: 2rem;
    font-weight: 600;
}

.admin-header-subtitle {
    margin: 5px 0 0 0;
    opacity: 0.9;
    font-size: 1.1rem;
}

.admin-activity-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.08);
    border: none;
    overflow: hidden;
}

.admin-section-title {
    background: #f8f9fa;
    margin: 0;
    padding: 20px 25px;
    border-bottom: 1px solid #dee2e6;
    font-size: 1.2rem;
    font-weight: 600;
}

.form-label {
    font-weight: 600;
    color: #495057;
}

.table-dark {
    background-color: #343a40 !important;
}

.table-hover tbody tr:hover {
    background-color: rgba(0,0,0,0.05);
}
</style>

<script>
// Auto-select product info when product is selected
document.getElementById('product_id').addEventListener('change', function() {
    const productId = this.value;
    if (productId) {
        const selectedOption = this.options[this.selectedIndex];
        const productText = selectedOption.text;
        const currentStock = productText.match(/Estoque: (\d+)/);
        if (currentStock) {
            document.getElementById('quantity_change').placeholder = `Estoque atual: ${currentStock[1]}. Digite + para adicionar, - para remover`;
        }
    }
});
</script>

{% endblock %}