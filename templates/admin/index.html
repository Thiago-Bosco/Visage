{% extends 'admin/master.html' %}
{% block body %}

<div class="container-fluid mt-4">
    <!-- Enhanced Golden Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="admin-header-card">
                <div class="admin-header-content">
                    <div class="admin-header-icon">
                        <i class="fas fa-warehouse"></i>
                    </div>
                    <div>
                        <h1 class="admin-header-title">Sistema de Gestão - Visage</h1>
                        <p class="admin-header-subtitle">Controle completo de estoque e vendas</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Statistics Cards Row -->
    <div class="row mb-4">
        <!-- Products Card -->
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="admin-stat-card">
                <div class="admin-stat-icon products">
                    <i class="fas fa-cube"></i>
                </div>
                <div class="admin-stat-content">
                    <h3 class="admin-stat-number">{{ total_products }}</h3>
                    <p class="admin-stat-label">Total de Produtos</p>
                    <small class="admin-stat-detail">{{ products_in_stock }} em estoque</small>
                </div>
            </div>
        </div>

        <!-- Stock Value Card -->
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="admin-stat-card">
                <div class="admin-stat-icon revenue">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="admin-stat-content">
                    <h3 class="admin-stat-number">R$ {{ "%.2f"|format(total_stock_value) }}</h3>
                    <p class="admin-stat-label">Valor do Estoque</p>
                    <small class="admin-stat-detail">Custo total</small>
                </div>
            </div>
        </div>

        <!-- Low Stock Alerts -->
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="admin-stat-card">
                <div class="admin-stat-icon alerts">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="admin-stat-content">
                    <h3 class="admin-stat-number">{{ low_stock_products }}</h3>
                    <p class="admin-stat-label">Estoque Baixo</p>
                    <small class="admin-stat-detail">{{ out_of_stock }} sem estoque</small>
                </div>
            </div>
        </div>

        <!-- Orders Card -->
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="admin-stat-card">
                <div class="admin-stat-icon orders">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="admin-stat-content">
                    <h3 class="admin-stat-number">{{ total_orders }}</h3>
                    <p class="admin-stat-label">Total de Pedidos</p>
                    <small class="admin-stat-detail">{{ pending_orders }} pendentes</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="admin-actions-card">
                <h2 class="admin-section-title">
                    <i class="fas fa-bolt text-gold me-2"></i>
                    Gestão de Estoque
                </h2>
                <div class="admin-actions-grid">
                    <a href="{{ url_for('product.index_view') }}" class="admin-action-btn">
                        <i class="fas fa-plus-circle"></i>
                        <span>Gerenciar Produtos</span>
                    </a>
                    <a href="{{ url_for('stockmovement.index_view') }}" class="admin-action-btn">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Movimentações</span>
                    </a>
                    <a href="{{ url_for('supplier.index_view') }}" class="admin-action-btn">
                        <i class="fas fa-truck"></i>
                        <span>Fornecedores</span>
                    </a>
                    <a href="{{ url_for('inventorymanagementview.adjust_stock') }}" class="admin-action-btn">
                        <i class="fas fa-edit"></i>
                        <span>Ajustar Estoque</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Dashboard Content -->
    <div class="row">
        <!-- Recent Stock Movements -->
        <div class="col-lg-6 mb-4">
            <div class="admin-activity-card">
                <h2 class="admin-section-title">
                    <i class="fas fa-history text-gold me-2"></i>
                    Movimentações Recentes
                </h2>
                <div class="admin-activity-list">
                    {% if recent_movements %}
                        {% for movement in recent_movements %}
                        <div class="admin-activity-item">
                            <div class="admin-activity-icon {{ 'success' if movement.movement_type == 'increase' else 'danger' }}">
                                <i class="fas fa-{{ 'plus' if movement.movement_type == 'increase' else 'minus' }}"></i>
                            </div>
                            <div class="admin-activity-content">
                                <p class="admin-activity-text">
                                    <strong>{{ movement.product.name }}</strong>: 
                                    {{ '+' if movement.movement_type == 'increase' else '-' }}{{ movement.quantity }}
                                </p>
                                <small class="admin-activity-time">{{ movement.created_at.strftime('%d/%m/%Y %H:%M') }}</small>
                                <small class="admin-activity-reason">{{ movement.reason }}</small>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-inbox fa-2x mb-2"></i>
                            <p>Nenhuma movimentação recente</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Low Stock Alerts -->
        <div class="col-lg-6 mb-4">
            <div class="admin-summary-card">
                <h2 class="admin-section-title">
                    <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                    Alertas de Estoque
                </h2>
                <div class="admin-summary-items">
                    {% if low_stock_alerts %}
                        {% for product in low_stock_alerts %}
                        <div class="admin-summary-item alert-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="admin-summary-label">{{ product.name }}</span>
                                    <small class="d-block text-muted">SKU: {{ product.sku or 'N/A' }}</small>
                                </div>
                                <div class="text-end">
                                    <span class="badge bg-{{ 'danger' if product.stock_quantity == 0 else 'warning' }}">
                                        {{ product.stock_quantity }} unidades
                                    </span>
                                    <small class="d-block text-muted">Mín: {{ product.min_stock_level }}</small>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <div class="mt-3">
                            <a href="{{ url_for('product.index_view') }}?flt1_6=" class="btn btn-sm btn-outline-warning">
                                <i class="fas fa-eye me-1"></i>
                                Ver Todos os Alertas
                            </a>
                        </div>
                    {% else %}
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-check-circle fa-2x mb-2 text-success"></i>
                            <p>Todos os produtos com estoque adequado</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Stats Row -->
    <div class="row">
        <div class="col-lg-4 mb-4">
            <div class="admin-summary-card">
                <h2 class="admin-section-title">
                    <i class="fas fa-chart-pie text-gold me-2"></i>
                    Resumo Financeiro
                </h2>
                <div class="admin-summary-items">
                    <div class="admin-summary-item">
                        <span class="admin-summary-label">Valor em Estoque (Custo)</span>
                        <span class="admin-summary-value">R$ {{ "%.2f"|format(total_stock_value) }}</span>
                    </div>
                    <div class="admin-summary-item">
                        <span class="admin-summary-label">Valor em Estoque (Varejo)</span>
                        <span class="admin-summary-value">R$ {{ "%.2f"|format(total_retail_value) }}</span>
                    </div>
                    <div class="admin-summary-item">
                        <span class="admin-summary-label">Margem Potencial</span>
                        <span class="admin-summary-value">R$ {{ "%.2f"|format(total_retail_value - total_stock_value) }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-4">
            <div class="admin-summary-card">
                <h2 class="admin-section-title">
                    <i class="fas fa-boxes text-gold me-2"></i>
                    Status do Estoque
                </h2>
                <div class="admin-summary-items">
                    <div class="admin-summary-item">
                        <span class="admin-summary-label">Produtos em Estoque</span>
                        <span class="admin-summary-value">{{ products_in_stock }}</span>
                    </div>
                    <div class="admin-summary-item">
                        <span class="admin-summary-label">Produtos com Estoque Baixo</span>
                        <span class="admin-summary-value text-warning">{{ low_stock_products }}</span>
                    </div>
                    <div class="admin-summary-item">
                        <span class="admin-summary-label">Produtos sem Estoque</span>
                        <span class="admin-summary-value text-danger">{{ out_of_stock }}</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-4">
            <div class="admin-summary-card">
                <h2 class="admin-section-title">
                    <i class="fas fa-shopping-cart text-gold me-2"></i>
                    Pedidos
                </h2>
                <div class="admin-summary-items">
                    <div class="admin-summary-item">
                        <span class="admin-summary-label">Total de Pedidos</span>
                        <span class="admin-summary-value">{{ total_orders }}</span>
                    </div>
                    <div class="admin-summary-item">
                        <span class="admin-summary-label">Pedidos Pendentes</span>
                        <span class="admin-summary-value text-warning">{{ pending_orders }}</span>
                    </div>
                    <div class="admin-summary-item">
                        <span class="admin-summary-label">
                            <a href="{{ url_for('order.index_view') }}" class="text-decoration-none">
                                Ver Todos os Pedidos <i class="fas fa-arrow-right"></i>
                            </a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.alert-item {
    border-left: 3px solid var(--bs-warning);
    padding-left: 10px;
    margin-bottom: 10px;
}

.admin-activity-reason {
    color: var(--bs-gray-600);
    font-style: italic;
    display: block;
}

.admin-summary-value.text-warning {
    color: var(--bs-warning) !important;
}

.admin-summary-value.text-danger {
    color: var(--bs-danger) !important;
}
</style>

{% endblock %}